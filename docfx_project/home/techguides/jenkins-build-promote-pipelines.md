## Use Jenkins to Build Pipelines

## Introduction

This document explains how to configure the Jenkins build and promote pipelines. 

**'Build pipeline'** builds the artifacts and deploys them in test environment. 

Once the testing is successful and it's ready for promotion, **'Promote pipeline'** deploys the tested artifacts into integrated dev environment. 

The core of the pipeline is the file called Jenkins File. It performs the list of jobs as illustrated in the flowchart. 

For this tutorial, we will be integrating Jenkins with GitHub so that Jenkins can pull the code and build artifacts.

![](./images/jenkins-build-promote-pipelines-flow.png)

1. Initiate Pipeline
2. Source Code Management
3. Repo /Branch name
4. Test Environment
5. Jenkins File 
6. Get Source Code - 7. Git Clone - private repo
8. Build Design Studio package - 9. Build with Maven - 10. Push the artifacts into repo
11. Deploy to dev integrated environment - 11. Git clone Core banking - 12. Copy artifacts to package folder - 13. Git push to core Banking repo
14. Integrated Dev Environments

To implement the Pipeline as a code we will use Jenkins Pipeline used to automate tasks associated with building, testing and deploying software.

## Prerequisites

*(Please note that all necessary information is explained below in the next chapters of current document)*

•	Valid SSH keys to clone the GIT repositories

•	Environments IDs - Test/Integrated Dev

•	Pipeline scripts - Build/Promote 

## Access Development Portal

Sign into following URL: `portal.temenos.cloud` using the credentials provided by Temenos (Username and Password):

![](./images/jenkins-build-portal-login.png)

<br>

## Create a new environment

Press **'New environment'**

![](./images/jenkins-build-new-environment.png)


Fill the following parameters and press **'Create environment'**:

•	Name

•	Description

•	Template

•	*Labels (optional)*

![](./images/jenkins-build-environment-fields.png)

> [!Note]
> It might take about 15 minutes to create the enviroment.
> 
>  Please refresh the page if the new environment doesn't appear 'green' after more than 15 minutes.

The environment named 'Integrated Dev Environment' has been created:

![](./images/jenkins-build-created-environment.png)


## Login to Jenkins

Click on the environment created and than go to Jenkins Dashboard

![](./images/jenkins-build-dashboard.png)

<br>

In the new screen, click Login button on the top-right corner:

![](./images/jenkins-build-dashboard-login.png)

<br>

Sign in with user ***admin*** and password ***changeit***

![](./images/jenkins-build-login.png)

> [!Note]
> After first login, you will need to change the password.

## Change the password

- Click on **'Admin'** button on top-right corner and then, on the left side, click on **'Configure'** button 

![](./images/jenkins-build-configure.png)

<br>

- Input a new password, confirm it, click **'Apply'** and then **'Save'**

![](./images/jenkins-build-change-password.png)

> [!Note]
> ![](./images/jenkins-build-coffee.png) In case of a coffee break during the Jenkins configuration, the session may expire. 
> 
> Make sure when you come back that you are **still** logged or login again.

## Build pipeline workflow

Build Pipeline works based on pipeline script (Jenkins file). 

**Requirements:**

 - It requires valid credentials to pull the code from your Git repository (Github/Gitlab..etc). Users need to add credentials to clone the git repositories. 
   - For setting up credentials please refer to below section "Add SSH keys inside Jenkins"


**Steps during build:**

 - Pulls the code from GIT 
 - Builds the artifacts using DS binaries
 - Deploys the artifacts in the TEST environments


## Generate SSH key

This section explains how to add the credentials in order to clone the Git repositories.

First, you will need a SSH key, which can be generated by using PuTTY:

![](./images/jenkins-build-putty.png)

As instructed on PuTTY screen, move the mouse over the blank area to generate the key.

After the key is generated, **COPY** the key, save it somewhere and click **'Save private key'** 

![](./images/jenkins-build-save-private-key.png)


## Add SSH Keys inside Jenkins

Go to Credentials from left pane inside Jenkins console and then click global:

![](./images/jenkins-build-credentials.png)

<br>

Then add credentials:

![](./images/jenkins-build-add-credentials.png)

<br>

 - A new screen is open. 

![](./images/jenkins-build-fields.png)

 - In the Kind box - click the dropdown button and select ‘SSH Username with private key’
 - Scope - you can leave the default option 'Global (Jenkins, node...)'
 - Choose a username. In current case we have chosen ‘gituser1’ so that we can easily identify that it is associated with demorepo repository in GitHub. 
 - Go to Private Key field, select **'Enter directly'** and paste the ***private*** key generated at previous step
 - Click OK

<br>

![](./images/jenkins-build-credentials-check.png)

<br>

You will see the following screen with user details:

<br>

![](./images/jenkins-build-user-id.png)

> [!Note]
> This uniqe ID of SSH key will be used in the pipeline scripts (Jenkins File) to clone the repositories. See next step.

## Configure Jenkins pipeline job to use SSH keys

  - Go to My View from left pane inside Jenkins console 

![](./images/jenkins-build-views.png) 

- Click on 'Build'

![](./images/jenkins-build-build.png) 

- Then on 'Configure'

![](./images/jenkins-build-cofigure.png) 

- And finally click on 'Pipeline'

![](./images/jenkins-build-pipeline.png) 

  - On the same screen, make sure you have the same details in Script Path as below, then click on Apply and 'Save' 

![](./images/jenkins-build-script-path.png) 

 - It’s time now to go ahead and build our job.

## Build the Jenkins job

Go to left pane inside Jenkins console and press 'Jenkins' button

![](./images/jenkins-build-start-job.png) 

Then click on 'Built on'

![](./images/jenkins-build-built-on.png) 

New screen is open. The following parameters are **required to change** according to your setup:

•	SrcRepo 

•	EnvID (see the note below)

•	emailRecipientsList (optional)


![](./images/jenkins-build-pipeline-build.png) 


> [!Note] The environment ID is the one that appears on the URL address after you login and you click on your environment:
> 
>![](./images/jenkins-build-environment-id.png) 


## Promote pipeline workflow

Go again to left pane inside Jenkins console and press 'Jenkins' button

Then click on 'Built on' button on 'Promote Changes' line

![](./images/jenkins-build-promote-changes.png) 

New screen is open:

![](./images/jenkins-build-promote-screen.png) 
